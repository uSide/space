
<!DOCTYPE HTML>
<html>
<head>
    <title>deus</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #fff;
        }
    </style>
    <script src="/pixi.js"></script>
    <script src="/mousetrap.min.js"></script>
    <script src="/box2d.min.js"></script>

</head>
<body>
    <script>
    var renderer = PIXI.autoDetectRenderer(window.innerWidth - 25, window.innerHeight - 25);
    document.body.appendChild(renderer.view);
    // create an new instance of a pixi stage
    var stage = new PIXI.Stage(0x66FF99);

    // create a texture from an image path
    var backgroundTexture = PIXI.Texture.fromImage("/bg.jpg");
    // create a new Sprite using the texture
    var background = new PIXI.Sprite(backgroundTexture);

    var textures = [];

    for (var i = 0; i < 150; i++) {
        var arr = ['000','00'+i, '0'+i, i];
        textures[i] = PIXI.Texture.fromImage("/stars/lol/Star03_"+arr[i.toString().length]+".png");
    }

    // create a new Sprite using the texture
    var star = new PIXI.MovieClip(textures);

    star.position.x = 500;
    star.position.y = 200;

    star.play();
    star.animationSpeed = 0.2;

    textures = [];

    for (var i = 0; i < 51; i++) {
        var arr = ['00','0'+i, i];
        textures[i] = PIXI.Texture.fromImage("/ships/lol/2s_0"+arr[i.toString().length]+"_cr.png");
    }

    // create a new Sprite using the texture
    var sh = new PIXI.MovieClip(textures);

    sh.play();
    sh.animationSpeed = 0.3;

    sh.anchor.x = 0.5;
    // sh.anchor.y = 0.5;

    textures = [];

    for (var i = 0; i < 51; i++) {
        var arr = ['00','0'+i, i];
        textures[i] = PIXI.Texture.fromImage("/ships/lol/2s_0"+arr[i.toString().length]+".png");
    }

    // create a new Sprite using the texture
    var bunny = new PIXI.MovieClip(textures);

    bunny.play();
    bunny.animationSpeed = 0.3;

    bunny.scale.x = 0.5;
    bunny.scale.y = 0.5;

    // center the sprites anchor point
    bunny.anchor.x = 0.5;
    bunny.anchor.y = 0.5;

    // move the sprite t the center of the screen
    bunny.position.x = 200;
    bunny.position.y = 100;

    // move the sprite t the center of the screen
    background.position.x = 0;
    background.position.y = 0;

    stage.addChild(background);
    stage.addChild(star);
    stage.addChild(bunny);
    stage.addChild(sh);

    var count = 0;

    var colorMatrix =  [1,0,0,0,
                        0,1,0,0,
                        0,0,1,0,
                        0,0,0,1];
                        
    var filter = new PIXI.ColorMatrixFilter();

    star.shader = filter;

    var render = function(){
        requestAnimationFrame(render);

        renderer.render(stage);
    }

    var keys = {
        right: false,
        left: false,
        up: false,
        maxSpeed: 7,
        speed: 0
    }

    Mousetrap.bind('right', function() {
        keys.right = true;
    });

    Mousetrap.bind('right', function() {
        keys.right = false;
    }, 'keyup');

    Mousetrap.bind('left', function() {
        keys.left = true;
    });

    Mousetrap.bind('left', function() {
        keys.left = false;
    }, 'keyup');

    Mousetrap.bind('up', function() {
        keys.up = true;
    });

    Mousetrap.bind('up', function() {
        keys.up = false;
    }, 'keyup');

    setInterval(function(){
        count += 0.1;
        
        colorMatrix[1] = Math.sin(count) * 3;
        colorMatrix[2] = Math.cos(count);
        colorMatrix[3] = Math.cos(count) * 1.5;
        colorMatrix[4] = Math.sin(count / 3) * 2;
        colorMatrix[5] = Math.sin(count / 2);
        colorMatrix[6] = Math.sin(count / 4);
        // filter.matrix = colorMatrix;
        // filter.syncUniforms();

        // if(!keys.right && !keys.left){
            if(keys.up && keys.speed < keys.maxSpeed){
                keys.speed += 0.2;
            } else if(!keys.right && !keys.left && keys.speed < 0.5){
                keys.speed = 0;
            } else if(keys.speed > 0){
                if((keys.right || keys.left) && keys.speed < keys.maxSpeed - 2){
                    keys.speed += 0.1;
                }

                keys.speed -= 0.1;
            }
        // }

        if(keys.right){
            bunny.rotation += 0.02;
            if(keys.speed < keys.maxSpeed - 2){
                keys.speed += 0.2;
            }
        }
        if(keys.left){
            bunny.rotation -= 0.02;
            if(keys.speed < keys.maxSpeed - 2){
                keys.speed += 0.2;
            }
        }

        // console.log(keys.speed);

        var angle = bunny.rotation % (2 * Math.PI);

        var deltas = polarToRect(keys.speed, angle);

        var shDeltas = polarToRect(20, angle);

        bunny.position.x += deltas[0];
        bunny.position.y -= deltas[1];

        sh.rotation = bunny.rotation;

        sh.scale.y = keys.speed / 2;

        sh.position.x = bunny.position.x - shDeltas[0];
        sh.position.y = bunny.position.y + shDeltas[1];
    }, 1);

    function rectToPolar(x, y){
        return [
            Math.sqrt(x * x + y * y),
            Math.atan2(x, y)
        ];
    }

    function polarToRect(r, phi){
        return [
            r * Math.sin(phi),
            r * Math.cos(phi)
        ];
    }

    requestAnimationFrame(render);
    </script>

    </body>
</html>